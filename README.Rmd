---
title: "Introduction to ARMET"
author: "Stefano Mangiola"
date: "6/25/2021"
output: html_document
---
---
title: "sccomp - Outlier-aware and count-based compositional analysis of single-cell data"
output: github_document
always_allow_html: true
---

<!-- badges: start -->
[![Lifecycle:maturing](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing) [![R build status](https://github.com/stemangiola/tidyseurat/workflows/R-CMD-check/badge.svg)](https://github.com/stemangiola/tidyseurat/actions/)
<!-- badges: end -->


```{r echo=FALSE}
knitr::opts_chunk$set( fig.path = "man/figures/")
```

# Installation

```{r eval=FALSE}
devtools::install_github("stemangiola/ARMET")
```

# Usage

```{r}
library(ARMET)
library(dplyr)
```

```{r}
data("test_mixture")
data("no_hierarchy_reference")

 estimates = 
 	test_mixture |>
	convoluted_glm(
   ~ factor_of_interest,
   .sample = sample,
   .transcript = symbol,
   .abundance = count,
   reference = no_hierarchy_reference 
  )
 
 estimates
```

```{r eval=FALSE, echo=FALSE}
ACC = readRDS("/stornext/Bioinf/data/bioinf-data/Papenfuss_lab/projects/mangiola.s/ARMET_dev/dev/armet_ACC_input.rds")
prior_survival_time = ACC |> filter(!alive) |> distinct(patient, DSS.time.cr) |> pull(DSS.time.cr)

 estimates = 
 	ACC |>
	convoluted_glm(
   ~ censored(DSS.time.cr, alive),
   .sample = patient,
	 .transcript = transcript,
	 .abundance = count, 
   reference = no_hierarchy_reference,
   prior_survival_time = prior_survival_time,
   transform_time_function = sqrt
  )
 
armet_obj = 	
	ACC |>
	setup_convolved_lm(
		~ censored(time, alive),
			.sample = patient,
			.transcript = transcript,
			.abundance = count, 
			prior_survival_time = prior_survival_time, 
			transform_time_function = sqrt
	)


armet_hypothesis_test = 
	armet_estimate |>
	test_hypothesis_convoluted_lm()
```

